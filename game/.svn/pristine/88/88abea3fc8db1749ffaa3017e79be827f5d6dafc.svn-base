package cr.fi.grupomutual.website.controllers;

import javax.servlet.http.HttpServletRequest;

import groovy.util.logging.Log4j;

import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RequestMapping;

import cr.fi.grupomutual.website.entities.Rate;
import cr.fi.grupomutual.website.utilities.Utils;
import cr.fi.grupomutual.website.ws.HomeWsClient;

@Log4j
@Controller
public class ErrorHandlerController{
	
	@Autowired
	HomeWsClient homeWsClient;
	
	@Autowired
	Utils util;
	Logger fileLog = Logger.getLogger("file");
	
	@RequestMapping(value = "/error/notfound")
	public String showErrorPage( HttpServletRequest request,Model model) {

		String company = (String) request.getSession().getAttribute("company");
		// Call the service RateChange, to get the rate change value
		Rate rate=null;
		// Call the service RateChange, to get the rate change value
		try {
			 rate = homeWsClient.getRateChangeValue();
		} catch (Exception e) {
			fileLog.error("Rate error "+e.toString());
			rate= new Rate();
			rate.setAmmountBuy("0");
			rate.setAmmountSell("0");
		}
		
		model.addAttribute("itemList", util.getIdItemsFooter(company));
		model.addAttribute("menuTit", util.viewListMenu(company));
		model.addAttribute(rate);
		model.addAttribute("footerCarousel", util.getFooterCarouselHTML());

		return "templateError";
	}
	
	@RequestMapping(value = "/error/ise")
	public String showIES(Model model) {

		return "internalServerError";
	}
}
